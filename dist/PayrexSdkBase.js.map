{"version":3,"sources":["../src/PayrexSdkBase.js"],"names":["require","URL","PayrexApiError","REQUIRED_FIELDS","PayrexSdkBase","options","forEach","value","Error","publicKey","secretKey","baseUrl","fetch","Headers","base64Encode","path","queryParams","fetchRequest","body","method","url","addQueryParams","searchParams","headers","Accept","Authorization","JSON","stringify","undefined","toString","buildFetchOptions","call","then","response","status","contentType","get","includes","TypeError","json","constructor","parseResponse","code","message","obj","prefix","key","hasOwnProperty","val","newPrefix","set","module","exports"],"mappings":"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","file":"PayrexSdkBase.js","sourcesContent":["const { URL } = require('whatwg-url');\nconst PayrexApiError = require('./PayrexApiError');\n\nconst REQUIRED_FIELDS = ['fetch', 'Headers', 'base64Encode'];\n\nclass PayrexSdkBase {\n  /**\n   * PayrexSdkBase constructor\n   * @param {object} options\n   * @param {string} options.publicKey\n   * @param {string} options.secretKey\n   * @param {string} options.baseUrl\n   * @param {function} options.fetch [Fetch function](https://fetch.spec.whatwg.org/)\n   * @param {function} options.Headers [Fetch Headers](https://fetch.spec.whatwg.org/)\n   * @param {function} options.base64Encode Function to encode string (utf-8) in base64\n   */\n  constructor(options = {}) {\n    REQUIRED_FIELDS\n      .forEach((value) => {\n        if (!options[value]) {\n          throw new Error(`Option \"${value}\" is required`);\n        }\n      });\n\n    const {\n      publicKey = '',\n      secretKey = '',\n      baseUrl = 'http://localhost:3000/',\n      fetch,\n      Headers,\n      base64Encode,\n    } = options;\n    if (!baseUrl) {\n      throw new Error('Option \"baseUrl\" is required');\n    }\n\n    this.publicKey = publicKey;\n    this.secretKey = secretKey;\n    this.baseUrl = baseUrl;\n    this.fetch = fetch;\n    this.Headers = Headers;\n    this.base64Encode = base64Encode;\n  }\n\n  /**\n   * Make GET request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  get(path = '', { queryParams = {} } = {}) {\n    return this.fetchRequest('GET', path, queryParams, null);\n  }\n\n  /**\n   * Make POST request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} body Body data\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  post(path = '', body = {}, { queryParams = {} } = {}) {\n    return this.fetchRequest('POST', path, queryParams, body);\n  }\n\n  /**\n   * Make PUT request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} body Body data\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  put(path = '', body = {}, { queryParams = {} } = {}) {\n    return this.fetchRequest('PUT', path, queryParams, body);\n  }\n\n  /**\n   * Make DELETE request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  remove(path = '', { queryParams = {} } = {}) {\n    return this.fetchRequest('DELETE', path, queryParams, null);\n  }\n\n  /**\n   * Build options for fetch\n   * @param method\n   * @param path\n   * @param queryParams\n   * @param body\n   * @private\n   */\n  buildFetchOptions(method = 'GET', path = '', queryParams = {}, body = {}) {\n    const url = new URL(path, this.baseUrl);\n    if (typeof queryParams === 'object') {\n      addQueryParams(url.searchParams, queryParams)\n    }\n    const options = {\n      method,\n      headers: new this.Headers({\n        Accept: 'application/json',\n        Authorization: `Basic ${this.base64Encode(`${this.publicKey}:${this.secretKey}`)}`,\n        'Content-type': 'application/json',\n      }),\n      body: body ? JSON.stringify(body) : undefined,\n    };\n    return { url: url.toString(), options };\n  }\n\n  /**\n   * Parse response\n   * @param {number} status Status code\n   * @param {object} body JSON body object\n   * @private\n   * @return {{err: null, body: {object}}}\n   */\n  static parseResponse(status, body) {\n    if (status === 200 || status === 304) {\n      return body;\n    }\n    const code = body && body.code ? body.code : null;\n    const message = body && body.message ? body.message : '';\n    if (status === 400) {\n      throw new PayrexApiError(code === null ? 'ValidationFailed' : code, message);\n    }\n    if (status === 404) {\n      throw new PayrexApiError(code === null ? 'NotFound' : code, message);\n    }\n    if (status === 403) {\n      throw new PayrexApiError(code === null ? 'Forbidden' : code, message);\n    }\n    if (status === 500) {\n      throw new PayrexApiError(code === null ? 'ServerError' : code, message);\n    }\n    throw new PayrexApiError('UnexpectedStatusCode', 'UnexpectedStatusCode');\n  }\n\n  fetchRequest(method, path, queryParams, body) {\n    const { url, options } = this.buildFetchOptions(method, path, queryParams, body);\n    return this\n      .fetch\n      .call(null, url, options)\n      .then((response) => {\n        const { status } = response;\n        const contentType = response.headers.get('content-type');\n        if (!(contentType && contentType.includes('application/json'))) {\n          throw new TypeError('Expected to recieve JSON');\n        }\n        return response\n          .json()\n          .then(json => this.constructor.parseResponse(status, json));\n      });\n  }\n}\n\nfunction addQueryParams(searchParams, obj, prefix = '') {\n  if (typeof obj === 'object') {\n    for (let key in obj) if (obj.hasOwnProperty(key)) {\n      const val = obj[key]\n      const newPrefix = prefix ? `${prefix}[${key}]` : key\n      if (typeof val === 'object') {\n        addQueryParams(searchParams, val, newPrefix)\n      } else {\n        searchParams.set(newPrefix, val)\n      }\n    }\n  }\n}\n\nPayrexSdkBase.PayrexApiError = PayrexApiError;\n\nmodule.exports = PayrexSdkBase;\n"]}