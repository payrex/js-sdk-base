{"version":3,"sources":["../src/PayrexSdkBase.js"],"names":["require","URL","PayrexApiError","REQUIRED_FIELDS","PayrexSdkBase","options","forEach","value","Error","publicKey","secretKey","baseUrl","fetch","base64Encode","path","queryParams","fetchRequest","body","method","url","Object","keys","key","searchParams","set","headers","Headers","Accept","Authorization","toString","buildFetchOptions","then","response","status","contentType","get","includes","TypeError","json","constructor","parseResponse","code","message","module","exports"],"mappings":"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","file":"PayrexSdkBase.js","sourcesContent":["const { URL } = require('whatwg-url');\nconst PayrexApiError = require('./PayrexApiError');\n\nconst REQUIRED_FIELDS = ['fetch', 'base64Encode'];\n\nclass PayrexSdkBase {\n  /**\n   * PayrexSdkBase constructor\n   * @param {object} options\n   * @param {string} options.publicKey\n   * @param {string} options.secretKey\n   * @param {string} options.baseUrl\n   * @param {function} options.fetch [Fetch function](https://fetch.spec.whatwg.org/)\n   * @param {function} options.base64Encode Function to encode string (utf-8) in base64\n   */\n  constructor(options = {}) {\n    REQUIRED_FIELDS\n      .forEach((value) => {\n        if (!options[value]) {\n          throw new Error(`Option \"${value}\" is required`);\n        }\n      });\n\n    const {\n      publicKey = '',\n      secretKey = '',\n      baseUrl = 'http://localhost:3000/',\n      fetch,\n      base64Encode,\n    } = options;\n    if (!baseUrl) {\n      throw new Error('Option \"baseUrl\" is required');\n    }\n\n    this.publicKey = publicKey;\n    this.secretKey = secretKey;\n    this.baseUrl = baseUrl;\n    this.fetch = fetch;\n    this.base64Encode = base64Encode;\n  }\n\n  /**\n   * Make GET request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  get(path = '', { queryParams = {} } = {}) {\n    return this.fetchRequest('GET', path, queryParams, null);\n  }\n\n  /**\n   * Make POST request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} body Body data\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  post(path = '', body = {}, { queryParams = {} } = {}) {\n    return this.fetchRequest('POST', path, queryParams, body);\n  }\n\n  /**\n   * Make PUT request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} body Body data\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  put(path = '', body = {}, { queryParams = {} } = {}) {\n    return this.fetchRequest('PUT', path, queryParams, body);\n  }\n\n  /**\n   * Make DELETE request\n   * @param {string} path Path (ex. \"/users\")\n   * @param {object} queryParams  Additional query params to merge\n   * @return {Promise}\n   */\n  remove(path = '', { queryParams = {} } = {}) {\n    return this.fetchRequest('DELETE', path, queryParams, null);\n  }\n\n  /**\n   * Build options for fetch\n   * @param method\n   * @param path\n   * @param queryParams\n   * @param body\n   * @private\n   */\n  buildFetchOptions(method = 'GET', path = '', queryParams = {}, body = {}) {\n    const url = new URL(path, this.baseUrl);\n    if (typeof queryParams === 'object') {\n      Object.keys(queryParams)\n        .forEach((key) => {\n          url.searchParams.set(key, queryParams[key]);\n        });\n    }\n    const options = {\n      method,\n      headers: new this.fetch.Headers({\n        Accept: 'application/json',\n        Authorization: `Basic ${this.base64Encode(`${this.publicKey}:${this.secretKey}`)}`,\n        'Content-type': 'application/json',\n      }),\n      body,\n    };\n    return { url: url.toString(), options };\n  }\n\n  /**\n   * Parse response\n   * @param {number} status Status code\n   * @param {object} body JSON body object\n   * @private\n   * @return {{err: null, body: {object}}}\n   */\n  static parseResponse(status, body) {\n    if (status === 200 || status === 304) {\n      return body;\n    }\n    const code = body && body.code ? body.code : null;\n    const message = body && body.message ? body.message : '';\n    if (status === 400) {\n      throw new PayrexApiError(code === null ? 'ValidationFailed' : code, message);\n    }\n    if (status === 404) {\n      throw new PayrexApiError(code === null ? 'NotFound' : code, message);\n    }\n    if (status === 403) {\n      throw new PayrexApiError(code === null ? 'Forbidden' : code, message);\n    }\n    if (status === 500) {\n      throw new PayrexApiError(code === null ? 'ServerError' : code, message);\n    }\n    throw new PayrexApiError('UnexpectedStatusCode', 'UnexpectedStatusCode');\n  }\n\n  fetchRequest(method, path, queryParams, body) {\n    const { url, options } = this.buildFetchOptions(method, path, queryParams, body);\n    return this\n      .fetch(url, options)\n      .then((response) => {\n        const { status } = response;\n        const contentType = response.headers.get('content-type');\n        if (!(contentType && contentType.includes('application/json'))) {\n          throw new TypeError('Expected to recieve JSON');\n        }\n        return response\n          .json()\n          .then(json => this.constructor.parseResponse(status, json));\n      });\n  }\n}\n\nPayrexSdkBase.PayrexApiError = PayrexApiError;\n\nmodule.exports = PayrexSdkBase;\n"]}